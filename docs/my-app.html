<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/google-map/google-map-marker.html">
<link rel="import" href="../bower_components/google-map/google-map-directions.html">
<link rel="import" href="my-icons.html">


  <link rel="import" href="/bower_components/iron-icons/iron-icons.html">
  <link rel="import" href="/bower_components/iron-icons/maps-icons.html">
  <link rel="import" href="/bower_components/iron-icons/social-icons.html">

  <link rel="import" href="/bower_components/iron-icon/iron-icon.html">
  <link rel="import" href="/bower_components/iron-icons/maps-icons.html">

  <script>
      var fuckThisButton;
      var fieldA;
      var fieldB;
   </script>
<dom-module id="my-app">
  <template>
    <style>
      :host {
        --app-primary-color: #4285f4;
        --app-secondary-color: black;

        display: block;
      }

      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
      }
      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      .drawer-list {
        margin: 0 20px;
      }

      .drawer-list a {
        display: block;

        padding: 0 16px;

        text-decoration: none;

        color: var(--app-secondary-color);

        line-height: 40px;
      }

      .drawer-list a.iron-selected {
        color: black;

        font-weight: bold;
      }

      paper-button.custom:hover {
        background-color: var(--paper-indigo-100);
      }
    </style>

        <app-drawer-layout fullbleed>

          <!-- Main content -->
          <app-header-layout has-scrolling-region>

            <app-header condenses reveals effects="waterfall">
              <app-toolbar>
                <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                <div style="padding-left:2%" main-title>HandyPanda</div>
              </app-toolbar>
            </app-header>

            <google-map zoom="15" latitude="50.834895" longitude="4.305228" api-key="AIzaSyB0iIVlNA4ZmseMcX0ajXNl3RwaDsTEtCM" style="height:100%;width:100%;position:absolute">

               <google-map-marker latitude="50.836387" longitude="4.314902" title="Obstacle à la chaîne de déplacement" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" on-google-map-marker-close="{{markerUnClicked}}" clickEvent=true>
               Obstacle à la chaîne de déplacement</google-map-marker>
               <google-map-marker latitude="50.836387" longitude="4.313466" title="Obstacle à la chaîne de déplacement" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>
               Obstacle à la chaîne de déplacement</google-map-marker>
               <google-map-marker latitude="50.836716" longitude="4.313386" title="Longueur de la pente supérieure à 12 %" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>
               Longueur de la pente supérieure à 12 %</google-map-marker>
               <google-map-marker latitude="50.836670" longitude="4.328279" title="Obstacle à la chaîne de déplacement" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>
               Obstacle à la chaîne de déplacement</google-map-marker>

               <google-map-marker latitude="50.827000431344" longitude="4.26621290480807" title="Obstacle à la chaîne de déplacement" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>
               Obstacle à la chaîne de déplacement</google-map-marker>
               <google-map-marker latitude="50.8271572824181" longitude="4.26635045573425" title="Pas d'inflexion de trottoir pour la traversée piétonne" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>
               Pas d'inflexion de trottoir pour la traversée piétonne</google-map-marker>
               <google-map-marker latitude="50.8175194307652" longitude="4.28388682566695" title="Largeur du trottoir insuffisante" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>
               Largeur du trottoir insuffisante</google-map-marker>
               <google-map-marker latitude="50.8222967037932" longitude="4.2958956344048" title="Obstacle à la chaîne de déplacement" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>
               Largeur du trottoir insuffisante</google-map-marker>

               <google-map-marker latitude="50.834632" longitude="4.321168" title="Largeur du trottoir insuffisante" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>Largeur du trottoir insuffisante</google-map-marker>
               <google-map-marker latitude="50.844632" longitude="4.326168" title="Obstacle à la chaîne de déplacement" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>Obstacle à la chaîne de déplacement</google-map-marker>
               <google-map-marker latitude="50.835712" longitude="4.289018" title="Obstacle à la chaîne de déplacement" icon="../images/warning-symbol.png" on-google-map-marker-close="{{markerUnClicked}}" on-google-map-marker-click="{{markerClicked}}" clickEvent=true>Obstacle à la chaîne de déplacement</google-map-marker>
            </google-map>

            <paper-material elevation="2" style="width:70%; height:5.8%; margin-left:15%; margin-right:15%; margin-top:10px; margin-bottom:10px;">
               <input id="pointAField" is="iron-input" placeholder="Start" bind-value="{{pointA}}" style="width:98.5%; border:0px; padding:10px; font-size:20pt">
            </paper-material>

            <paper-material elevation="2" style="width:70%; height:5.8%; margin-left:15%; margin-right:15%; margin-top:20px; margin-bottom:10px;">
               <input id="pointBField" is="iron-input" placeholder="Destination" bind-value="{{pointB}}" style="width:98.5%; border:0px; padding:10px; font-size:20pt">
            </paper-material>

            <paper-button style="background-color:#ddf;margin-left:15%;margin-top:1%" toggles raised onclick="transportMode = (transportMode + 1) % 2; fuckThisButton.style.backgroundColor = transportModeColors[transportMode];fuckThisButton.innerHTML = transportModes[transportMode];">
               Wheelchair
            </paper-button>

            <paper-button style="background-color:#ddf;margin-left:15%;margin-top:1%" toggles raised onclick="avoidObstacles(obstacles_toAvoid)">
               Avoid selected obstacles
            </paper-button>

            <paper-button style="background-color:#ddf;margin-left:15%;margin-top:1%" toggles raised onclick="computeItinerary(fieldA, fieldB, fuckThisButton)">
               Search
            </paper-button> 

          </app-header-layout>
        </app-drawer-layout>
  </template>

  <script>
    Polymer({
      is: 'my-app',

      properties: {
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        }
      },

      observers: [
        '_routePageChanged(routeData.page)'
      ],

      _routePageChanged: function(page) {
        this.page = page || 'view1';
      },

      _pageChanged: function(page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl('my-' + page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function() {
        this.page = 'view404';
      }
    });

    var transportMode = 0;
    var transportModes = ["Wheelchair", "Public Transports"];
    var transportModeColors = ["#ddf","#dfd"];
    var transportModeIcons = ["accessible","directions-subway"];
    var obstacles_toAvoid - [];
    var template = document.querySelector('template');


    setTimeout(function() {
      fuckThisButton = document.body.children[0].shadowRoot.children[1].children[0].children[4];
      fieldA = document.body.children[0].shadowRoot.children[1].children[0].children[2];
      fieldB = document.body.children[0].shadowRoot.children[1].children[0].children[3];
   }, 2000);

   markerClicked: function(e, detail, sender) {
         obstacles_toAvoid.push(sender.info.content);
          //Seting marker infowindow to be open by default using it's API
          //
          //Select the map and the marker:
          var map_marker_1 =  this.$.map_marker_1;
          var google_map = this.$.map_1;
          //Open the info:
          google_map_marker.info.open(google_map.map, google_map_marker.marker);
          /////////////////////////////////////

          /////////////////////////////////////
          //Closing marker infowindow
          //
          //console.log(sender.tagName);
          //console.log(sender.info);//marker's info object
          //console.log(sender.info.content);

          //or select the marker by id:
          //var map_marker_1 =  this.$.map_marker_1;

          //this is closing marker infowindow
          sender.info.close();
          //or
          // map_marker_1.info.close();
          /////////////////////////////////////

      }

      function markerUnClick(){

      }

   function avoidObstacles(){
      // google-map-marker-click: register clicks on markers: add to obstacles_toAvoid
      // google-map-marker-close
   }

   function computeItinerary(source, destination, transportType){
      // https://route.cit.api.here.com/routing/7.2/calculateroute.json?app_id=SvFi6K3dicgKRVDFFI5E&app_code=jR2-a5GhyX3L-lSE-fQvQA&waypoint0=geo!50.854415,4.339326&waypoint1=geo!50.851723,4.352246&departure=now&mode=fastest;publicTransport&combineChange=true&routeattributes=li,gr&maneuverattributes=all&lineattributes=all
      // if &mode=fastest;publicTransport&combineChange=true, it is a transport
      var router = platform.getRoutingService(),
       routeRequestParams = {
         mode: 'shortest;pedestrian',
         representation: 'display',
         waypoint0: '51.5141,-0.0999', // St Paul's Cathedral
         waypoint1: '51.5081,-0.0985',  // Tate Modern
         routeattributes: 'waypoints,summary,shape,legs',
         maneuverattributes: 'direction,action'
       };


     router.calculateRoute(
       routeRequestParams,
       onSuccess,
       onError
     );
  }
   /**
    * This function will be called once the Routing REST API provides a response
    * @param  {Object} result          A JSONP object representing the calculated route
    *
    * see: http://developer.here.com/rest-apis/documentation/routing/topics/resource-type-calculate-route.html
    */
   function onSuccess(result) {
     var route = result.response.route[0];
    /*
     * The styling of the route response on the map is entirely under the developer's control.
     * A representitive styling can be found the full JS + HTML code of this example
     * in the functions below:
     */
     addRouteShapeToMap(route);
     addManueversToMap(route);

     addWaypointsToPanel(route.waypoint);
     addManueversToPanel(route);
     addSummaryToPanel(route.summary);
     // ... etc.
   }

   /**
    * This function will be called if a communication error occurs during the JSON-P request
    * @param  {Object} error  The error message received.
    */
   function onError(error) {
     alert('Ooops!');
  }


  </script>
</dom-module>
